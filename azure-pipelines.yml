# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: ubuntu-latest

parameters:
- name: 'AutoRunMachine'
  type: object
  default: [
    10.10.10.1,
    10.10.10.2,
    10.10.10.3
  ]

stages:
  - stage: OpenRdpConnections
    displayName: Open RDP Connections
    jobs:
    - job: OpenConnections
      displayName: Open Connections
      steps:
        ${{ each p in parameters.AutoRunMachine }}
        - task: PowerShell@2
          displayName: Open Connection to $(AutoRunMachine)
          inputs:
            targetType: 'inline'
            errorActionPreference: 'continue'
            failOnStderr: true
            showWarnings: true
            pwsh: true
            script: |
              #cmdkey /generic:TERMSRV/"10.2.2.185" /user:"TSTA.local\Autouser" /pass:"P@ssw0rd"
              #mstsc.exe "C:\AutoRun\Tools\RDP\RDP_Settings.rdp" /v "10.2.2.185"